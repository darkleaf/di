{:path [], :nextjournal/value {:package :directory, :toc {:path [], :nextjournal/value [], :nextjournal/render-opts {:toc-visibility false, :set-hash? true}, :nextjournal/viewer {:name nextjournal.clerk.viewer/toc-viewer, :render-fn #viewer-fn nextjournal.clerk.render.navbar/render-items, :hash "5dtesrAmYqLZQQHSMEfFTNpmLtY4nC"}}, :sidenotes? false, :toc-visibility false, :atom-var-name->state #viewer-eval (nextjournal.clerk.render/intern-atoms! {}), :ns #viewer-eval (ns darkleaf.di.add-side-dependency-test), :file "test/darkleaf/di/add_side_dependency_test.clj", :scope darkleaf.di.add-side-dependency-test, :header {:path [], :nextjournal/value [:div.viewer.w-full.max-w-prose.px-8.not-prose.mt-3 [:div.mb-8.text-xs.sans-serif.text-slate-400 nil [:<> [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href "./../../../../"} "Index"] [:span.mx-2 "â€¢"]] [:span "Generated with " [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href "https://clerk.vision"} "Clerk"] [:<> " from " [:a.font-medium.border-b.border-dotted.border-slate-300.hover:text-indigo-500.hover:border-indigo-500.dark:border-slate-500.dark:hover:text-white.dark:hover:border-white.transition {:href nil} "test/darkleaf/di/add_side_dependency_test.clj" nil]]]]], :nextjournal/viewer {:name nextjournal.clerk.viewer/html-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-html, :hash "5drpr3yzJ1CcHNbRHnK2sVyn7YUmXB"}}, :open-graph {:type "article:clerk", :title nil, :description nil}, :blocks [{:path [], :nextjournal/value [{:path [0], :nextjournal/value "(ns darkleaf.di.add-side-dependency-test\n  (:require\n   [clojure.test :as t]\n   [darkleaf.di.core :as di]))", :nextjournal/render-opts {:loc {:line 1, :end-line 4, :column 1, :end-column 31}, :id "darkleaf.di.add-side-dependency-test/anon-expr-5drC56nbPXNssTHL7pdQsAr2T5YvxZ-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(t/deftest bug--array-map->hash-map--prepare\n  (t/is (= clojure.lang.PersistentArrayMap\n           (class {:a 1\n                   :b 2\n                   :c 3\n                   :d 4\n                   :e 5\n                   :f 6\n                   :g 7\n                   :h 8})))\n  (t/is (= clojure.lang.PersistentHashMap\n           (class {:a 1\n                   :b 2\n                   :c 3\n                   :d 4\n                   :e 5\n                   :f 6\n                   :g 7\n                   :h 8\n                   :i 9}))))", :nextjournal/render-opts {:loc {:line 6, :end-line 25, :column 1, :end-column 29}, :id "darkleaf.di.add-side-dependency-test/bug--array-map->hash-map--prepare-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$bug__array_map__GT_hash_map__prepare 0x1d9f40af \"darkleaf.di.add_side_dependency_test$bug__array_map__GT_hash_map__prepare@1d9f40af\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug--array-map->hash-map--prepare-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug--array-map->hash-map--prepare-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- a\n  {::di/kind :component}\n  []\n  :a)", :nextjournal/render-opts {:loc {:line 27, :end-line 30, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/a-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$a 0x4eb0f3ed \"darkleaf.di.add_side_dependency_test$a@4eb0f3ed\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/a-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/a-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- b\n  {::di/kind :component}\n  []\n  :b)", :nextjournal/render-opts {:loc {:line 32, :end-line 35, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/b-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$b 0x16415b48 \"darkleaf.di.add_side_dependency_test$b@16415b48\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/b-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/b-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- c\n  {::di/kind :component}\n  []\n  :c)", :nextjournal/render-opts {:loc {:line 37, :end-line 40, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/c-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$c 0x4480b27 \"darkleaf.di.add_side_dependency_test$c@4480b27\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/c-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/c-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- d\n  {::di/kind :component}\n  []\n  :d)", :nextjournal/render-opts {:loc {:line 42, :end-line 45, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/d-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$d 0x6335a939 \"darkleaf.di.add_side_dependency_test$d@6335a939\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/d-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/d-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- e\n  {::di/kind :component}\n  []\n  :e)", :nextjournal/render-opts {:loc {:line 47, :end-line 50, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/e-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$e 0x2a530129 \"darkleaf.di.add_side_dependency_test$e@2a530129\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/e-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/e-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- f\n  {::di/kind :component}\n  []\n  :f)", :nextjournal/render-opts {:loc {:line 52, :end-line 55, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/f-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$f 0x36d49430 \"darkleaf.di.add_side_dependency_test$f@36d49430\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/f-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/f-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- g\n  {::di/kind :component}\n  []\n  :g)", :nextjournal/render-opts {:loc {:line 57, :end-line 60, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/g-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$g 0x7281a0fe \"darkleaf.di.add_side_dependency_test$g@7281a0fe\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/g-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/g-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- h\n  {::di/kind :component}\n  []\n  :h)", :nextjournal/render-opts {:loc {:line 62, :end-line 65, :column 1, :end-column 6}, :id "darkleaf.di.add-side-dependency-test/h-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$h 0x3cb3a3f6 \"darkleaf.di.add_side_dependency_test$h@3cb3a3f6\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/h-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/h-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- side-dep\n  {::di/kind :component}\n  []\n  :side-dep)", :nextjournal/render-opts {:loc {:line 67, :end-line 70, :column 1, :end-column 13}, :id "darkleaf.di.add-side-dependency-test/side-dep-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$side_dep 0xedba700 \"darkleaf.di.add_side_dependency_test$side_dep@edba700\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/side-dep-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/side-dep-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(t/deftest bug-array-map->hash-map\n  (let [log          (atom [])\n        after-build! (fn [{:keys [key]}]\n                       (swap! log conj key))]\n    (with-open [root (di/start ::root\n                               {::root (di/template\n                                        {:a (di/ref `a)\n                                         :b (di/ref `b)\n                                         :c (di/ref `c)\n                                         :d (di/ref `d)\n                                         :e (di/ref `e)\n                                         :f (di/ref `f)\n                                         :g (di/ref `g)\n                                         :h (di/ref `h)})}\n                               (di/add-side-dependency `side-dep)\n                               (di/log :after-build! after-build!))]\n      (t/is (= [`a `b `c `d `e `f `g `h\n                ::root `di/new-key#0 `side-dep ::di/implicit-root] @log))\n      (t/is (= {:a :a\n                :b :b\n                :c :c\n                :d :d\n                :e :e\n                :f :f\n                :g :g\n                :h :h} @root)))))", :nextjournal/render-opts {:loc {:line 72, :end-line 97, :column 1, :end-column 34}, :id "darkleaf.di.add-side-dependency-test/bug-array-map->hash-map-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$bug_array_map__GT_hash_map 0x1cbcd7ff \"darkleaf.di.add_side_dependency_test$bug_array_map__GT_hash_map@1cbcd7ff\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug-array-map->hash-map-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug-array-map->hash-map-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(defn- side-dep2\n  {::di/kind :component}\n  []\n  :side-dep2)", :nextjournal/render-opts {:loc {:line 99, :end-line 102, :column 1, :end-column 14}, :id "darkleaf.di.add-side-dependency-test/side-dep2-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$side_dep2 0x63c512c6 \"darkleaf.di.add_side_dependency_test$side_dep2@63c512c6\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/side-dep2-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/side-dep2-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(t/deftest bug-array-map->hash-map-2\n  (let [log          (atom [])\n        after-build! (fn [{:keys [key]}]\n                       (swap! log conj key))]\n    (with-open [root (di/start ::root\n                               (di/add-side-dependency `side-dep)\n                               {::root (di/template\n                                        {:a (di/ref `a)\n                                         :b (di/ref `b)\n                                         :c (di/ref `c)\n                                         :d (di/ref `d)\n                                         :e (di/ref `e)\n                                         :f (di/ref `f)\n                                         :g (di/ref `g)\n                                         :h (di/ref `h)})}\n                               (di/add-side-dependency `side-dep2)\n                               (di/log :after-build! after-build!))]\n      (t/is (= [`a `b `c `d `e `f `g `h\n                ::root\n                `di/new-key#0 `side-dep\n                `di/new-key#1 `side-dep2\n                ::di/implicit-root]\n               @log))\n      (t/is (= {:a :a\n                :b :b\n                :c :c\n                :d :d\n                :e :e\n                :f :f\n                :g :g\n                :h :h} @root)))))", :nextjournal/render-opts {:loc {:line 104, :end-line 134, :column 1, :end-column 34}, :id "darkleaf.di.add-side-dependency-test/bug-array-map->hash-map-2-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$bug_array_map__GT_hash_map_2 0x4248a15b \"darkleaf.di.add_side_dependency_test$bug_array_map__GT_hash_map_2@4248a15b\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug-array-map->hash-map-2-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug-array-map->hash-map-2-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}} {:path [], :nextjournal/value [{:path [0], :nextjournal/value "(t/deftest bug-with-update-key\n  (let [info (di/inspect ::root\n                         {::root     42\n                          ::unused   0\n                          ::side-dep :side-dep}\n                         (di/add-side-dependency ::side-dep)\n                         (di/update-key ::unused inc))\n        keys (into #{}\n                   (map :key)\n                   info)]\n    (t/is (contains? keys ::side-dep))))", :nextjournal/render-opts {:loc {:line 136, :end-line 146, :column 1, :end-column 41}, :id "darkleaf.di.add-side-dependency-test/bug-with-update-key-code"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/code-block-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-code-block, :hash "5dru1FUcVRTRrVKJFbNw4FG2wXmiwB"}} {:path [1], :nextjournal/value {:nextjournal/presented {:path [1], :nextjournal/value "#object[darkleaf.di.add_side_dependency_test$bug_with_update_key 0x11f8edb5 \"darkleaf.di.add_side_dependency_test$bug_with_update_key@11f8edb5\"]", :nextjournal/viewer {:name nextjournal.clerk.viewer/read+inspect-viewer, :render-fn #viewer-fn (fn [x] (try [nextjournal.clerk.render/inspect (nextjournal.clerk.viewer/read-string-without-tag-table x)] (catch js/Error _e (nextjournal.clerk.render/render-unreadable-edn x)))), :hash "5dt2ru159tAMavCJULP69Zvz1i4Zfd"}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug-with-update-key-result-1"}}, :nextjournal/blob-id nil}, :nextjournal/render-opts {:id "darkleaf.di.add-side-dependency-test/bug-with-update-key-result-1"}, :nextjournal/viewer {:name nextjournal.clerk.viewer/result-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-result, :hash "5dtGVHesd2XCTLFYF3aY4kJvkrX1x1"}}], :nextjournal/viewer {:name nextjournal.clerk.viewer/cell-viewer, :render-fn #viewer-fn (fn [xs opts] (into [:<>] (nextjournal.clerk.render/inspect-children opts) xs)), :hash "5dtX6xLh3vbeFdswBY6jLXmB8QTqo2"}}]}, :nextjournal/viewer {:name nextjournal.clerk.viewer/notebook-viewer, :render-fn #viewer-fn nextjournal.clerk.render/render-notebook, :hash "5duAFDxE4sCnRX71Wo6zeCpC9C3djE"}}